#!/bin/bash
# List GitHub notifications in AI-friendly format
# Usage: list-github-notifications

set -euo pipefail

# Source shared utilities
source "$(dirname "$0")/../shared.sh"

# Get notifications as JSON
notifications=$(gh api notifications --paginate)

# Check if there are any notifications
if [ "$notifications" = "[]" ]; then
    echo "No unread notifications"
    exit 0
fi

# Parse and format for AI
echo "$notifications" | jq -r '
  to_entries |
  .[] |
  "[\(.key + 1)] \(.value.repository.full_name) - \(.value.subject.title)\n    Type: \(.value.subject.type)\n    Reason: \(.value.reason)\n    URL: \(.value.subject.url // .value.url)\n    Thread: \(.value.id)\n"
'
