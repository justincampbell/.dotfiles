#!/bin/bash
# Check out a GitHub PR in the main repository (not a worktree)

set -euo pipefail

# Source shared utilities
source "$(dirname "$0")/../shared.sh"

# Get GitHub PR URL from argument
pr_url="$1"

if [ -z "$pr_url" ]; then
    echo "Usage: checkout-github-pr-main <github-pr-url>" >&2
    exit 1
fi

# Parse GitHub PR URL
read -r org repo pr_number < <(parse_github_url "$pr_url" true)
if [ $? -ne 0 ]; then
    exit 1
fi

# Ensure repository is cloned
repo_url="https://github.com/$org/$repo"
repo_path=$("$(dirname "$0")/ensure-github-clone" "$repo_url")

# Change to main repository directory
cd "$repo_path"

# Use gh CLI to checkout the PR branch
echo "Checking out PR #$pr_number in main repository..." >&2
gh pr checkout "$pr_number"

# Output the main repo path (for task chaining)
echo "$repo_path"
